# 게스트 예약·결제 UX 플로우 (호스트 승인 후 결제)

## 전제

- **예약 확정은 호스트 승인 이후에만 가능**하다.
- 게스트는 먼저 **예약 요청**(결제 없음)을 하고, 호스트가 승인한 뒤 **24시간 이내에 결제**하면 예약이 확정된다.

---

## 플로우 요약

```
[숙소 상세] → [예약 확인] → [예약 요청] → [예약 완료 페이지]
                                    ↓
                    status: pending (호스트 응답 대기)
                                    ↓
              호스트 승인 → status: confirmed, paymentStatus: pending
                                    ↓
                    [이메일 결제 링크] / [내 예약] 결제하기
                                    ↓
                    [결제 페이지] → 결제 완료 → 예약 확정
```

---

## 단계별 화면·문구

### 1. 예약 확인 (`/booking/confirm`)

- **예약 진행 방식** 3단계 안내:
  1. 예약 요청 (지금 결제 없음)
  2. 호스트 승인 (24시간 이내 승인/거절)
  3. 결제 완료 (승인 후 24시간 이내 결제 시 예약 확정)
- **예약 전 확인사항**: 지금 결제 없음, 승인 후 결제 안내 이메일, 승인 전 무료 취소.
- **버튼**: 「예약 요청하기」 + 「호스트가 승인하기 전까지 요금이 청구되지 않습니다.」「승인 후 이메일로 받은 결제 링크에서 결제하면 예약이 확정됩니다.»

### 2. 예약 요청 완료 직후 (`/booking/complete?id=...`)

- **상태**: `pending` (호스트 응답 대기)
- **제목**: 「예약 요청이 접수되었습니다」
- **설명**: 호스트가 24시간 이내에 승인하면 결제 안내 이메일이 발송됩니다.
- **다음 단계** 박스: 1) 호스트 검토 2) 승인 시 이메일 발송 3) 결제 완료 시 확정 + 「내 예약에서 승인·결제 상태를 확인할 수 있어요.」
- **CTA**: 내 예약 보기, 숙소 다시 보기

### 3. 호스트 승인 후 (`/booking/complete`, `/my-bookings`, 이메일)

- **예약 완료 페이지** (`/booking/complete?id=...`):
  - **제목**: 「호스트가 예약을 승인했습니다」
  - **설명**: 24시간 이내에 결제를 완료하면 예약이 최종 확정됩니다.
  - **24시간 안내** 박스: 「24시간 이내에 결제를 완료해 주세요.」「결제하지 않으면 예약이 자동 취소될 수 있습니다.」
  - **CTA**: **결제하기** (1순위), 내 예약 보기, 숙소 다시 보기

- **내 예약** (`/my-bookings`):
  - 배지: 「호스트 승인 · 결제 대기」
  - 안내: 「24시간 이내 결제 시 예약 확정 · 미결제 시 자동 취소될 수 있어요.」
  - **결제하기** / **재결제하기** 버튼 → `/booking/{id}/pay`

- **이메일**: 호스트 승인 완료 메일에 24시간 안내 + **결제하기** 버튼 (결제 페이지 링크)

### 4. 결제 페이지 (`/booking/[id]/pay`)

- **전제**: `status === "confirmed"` 일 때만 진입 가능. `pending` / `cancelled` 이면 `/my-bookings`로 리다이렉트.
- **안내**: 「호스트가 승인한 예약입니다. 결제를 완료하면 예약이 확정됩니다.」
- 숙소 정보 + 결제 금액 + 결제 버튼

### 5. 결제 완료 후

- 결제 페이지에서 결제 성공 시 → `/my-bookings`로 이동.
- 예약 완료 페이지에서 `status === "confirmed"` && `paymentStatus === "paid"` 이고 대화가 있으면 → `/messages/{conversationId}`로 리다이렉트.
- **내 예약** 배지: 「예약 확정」

---

## 상태별 정리

| status   | paymentStatus | 게스트 화면 안내 |
|----------|----------------|------------------|
| pending  | -              | 호스트 응답 대기, 승인 시 이메일로 결제 안내 |
| confirmed| pending/failed | 호스트 승인 · 결제 대기, 24시간 이내 결제 |
| confirmed| paid           | 예약 확정 |
| cancelled| -              | 취소됨 |

---

## 관련 파일

- 예약 확인: `src/app/booking/confirm/BookingConfirmContent.tsx`
- 예약 완료: `src/app/booking/complete/page.tsx`
- 내 예약: `src/app/my-bookings/page.tsx`
- 결제: `src/app/booking/[id]/pay/page.tsx`, `PayButton.tsx`
- 이메일: `src/lib/email-templates.ts` (hostApprovedGuest 등)
