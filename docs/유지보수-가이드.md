# 유지보수 가이드 (스마트 운영)

이 문서는 airbnb-clone을 **최소 비용·일관된 방식**으로 유지·보수하기 위한 체크리스트와 절차입니다.

---

## 1. 일상적인 개발 흐름

| 할 일 | 명령/위치 |
|------|-----------|
| 로컬 실행 | `npm run dev` |
| DB 스키마 변경 | `prisma/schema.prisma` 수정 → `npm run db:migrate` |
| DB 데이터 보기/수정 | `npm run db:studio` |
| 초기 데이터 넣기 | `npm run db:seed` 또는 `node prisma/seed-one-user.js` |
| 린트 확인 | `npm run lint` |
| 빌드 확인 | `npm run build` |

**권장**: 기능 수정 전후에 `npm run lint`와 `npm run build`를 한 번씩 돌려 두면 배포 전 오류를 줄일 수 있습니다.

---

## 2. 정기 점검 (주 1회 또는 배포 전)

- [ ] `npm run lint` 통과
- [ ] `npm run build` 통과
- [ ] `.env` / `.env.example` 동기화 (새 변수 추가 시 예제에 주석으로 명시)
- [ ] `docs/` 문서와 실제 동작 일치 여부 확인 (경로·명령 변경 시 문서 수정)
- [ ] **메시지창 자동 메시지**: 신규 DB·배포 시 `npm run db:seed` 로 공식 계정(`official@tokyominbak.com`) 생성 여부 확인. 없으면 예약 직후/호스트 승인 시 채팅 자동 메시지가 생성되지 않으며, 서버 로그에 `Official account not found` 경고가 뜹니다.

---

## 3. DB 백업 (운영 시 권장)

- **SQLite** (`prisma/dev.db` 등): 파일 복사로 백업 가능.
  ```bash
  # 예: 백업 폴더에 날짜별 복사
  copy prisma\dev.db prisma\backups\dev.db.%date:~0,4%%date:~5,2%%date:~8,2%
  ```
- **Supabase/PostgreSQL**: Supabase 대시보드에서 백업 설정 또는 `pg_dump` 사용.
- **Prisma 마이그레이션**: `prisma/migrations/` 폴더는 **반드시 Git에 커밋**하여 팀/서버와 스키마를 맞춥니다.

---

## 4. 의존성 업데이트

- **점진적 업데이트**: 한 번에 올리지 말고, 주로 `npm outdated`로 확인 후 패키지별로 올린 뒤 `npm run build`·`npm run lint`로 검증.
- **Next.js / React 메이저**: 공식 마이그레이션 가이드 참고 후 단계별 적용.
- **Prisma**: [Prisma Release Notes](https://github.com/prisma/prisma/releases) 확인 후 마이그레이션 호환 여부 확인.

---

## 5. 환경별 설정 정리

| 환경 | DATABASE_URL | NEXTAUTH_URL | 비고 |
|------|--------------|--------------|------|
| 로컬 개발 | SQLite 또는 로컬 PostgreSQL | `http://localhost:3000` | `DEV_SKIP_AUTH=1` 가능 (배포 시 제거) |
| 스테이징/운영 | Supabase 등 실제 DB | 실제 도메인 | `NEXTAUTH_SECRET` 반드시 설정 |

- **비밀·키**: `.env`는 Git에 올리지 않음 (`.gitignore`에 포함됨). 배포 플랫폼(Vercel 등)에서는 환경 변수를 설정 화면에서 입력.

---

## 6. 문제 해결 빠른 참조

| 증상 | 확인할 것 |
|------|------------|
| Prisma 클라이언트 타입 오류 | `npm run db:generate` 실행 |
| 마이그레이션 충돌 | `prisma/migrations` 히스토리와 현재 스키마 비교, 필요 시 새 마이그레이션 생성 |
| 로그인/세션 오류 | `NEXTAUTH_SECRET`, `NEXTAUTH_URL`, OAuth 콜백 URL 확인 |
| 빌드 실패 | `npm run build` 로그에서 첫 번째 에러 파일·라인 확인, `next.config.mjs` 및 env 사용처 확인 |

---

## 7. 코드/문서 구조 유지

- **페이지**: `src/app/` (App Router)
- **공통 컴포넌트**: `src/components/` (기능별 하위 폴더)
- **비즈니스/DB 로직**: `src/lib/` (prisma, auth, bookings 등)
- **설정·문서**: 루트의 `README.md`, `docs/` (DB 관리, OAuth, 유지보수, Supabase 등)

새 기능 추가 시 위 구조에 맞추고, **공통 패턴은 `.cursor/rules/`** 에 정리해 두면 AI와 사람 모두 일관되게 유지보수할 수 있습니다.

---

## 8. 요약

- **일상**: `dev` → 수정 → `lint` / `build` 로 검증
- **정기**: 주 1회 또는 배포 전 점검 + DB 백업(운영 시)
- **의존성**: 단계적 업데이트, 빌드/린트로 검증
- **문서**: `README.md`, `docs/` 와 `.cursor/rules/` 를 실제 코드와 맞춰 두기

이 흐름을 지키면 유지·보수를 스마트하게 이어갈 수 있습니다.
