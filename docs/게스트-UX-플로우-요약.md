# 게스트 UX 플로우 요약 (문의 → 체크아웃)

## 전체 흐름 한눈에

```
[문의] → [검색·숙소 보기] → [예약 요청] → [호스트 승인] → [결제] → [예약 확정] → [숙박·체크아웃] → [리뷰]
```

---

## 1. 문의 (예약 전)

| 경로 | 설명 |
|------|------|
| **카톡 문의** | 전역 우하단 고정 버튼(카톡문의). 예약 없이 운영자/플랫폼 문의용 |
| **고객 문의(한국)** | 푸터 전화번호 등 (고객 문의처) |
| **숙소 상세 페이지** | "궁금한 점이 있으시면 언제든 문의해 주세요" 문구 — 실제 액션은 카톡/전화 유도 |
| **앱 내 메시지** | **예약이 생긴 뒤에만** 사용 가능. 예약 전 호스트와의 1:1 채팅은 없음 |

→ **예약 전 문의 = 카톡/전화**. 예약 후 문의 = **메시지**(호스트와 대화).

---

## 2. 검색·숙소 보기

| 단계 | 화면 | 설명 |
|------|------|------|
| 진입 | 홈(`/`) 또는 **숙소 검색**(`/search`) | 지역·날짜·인원·가격 등 필터로 검색 |
| 목록 | 검색 결과 | 리스팅 카드 클릭 → 숙소 상세 |
| 상세 | `/listing/[id]` | 사진·설명·가격·리뷰·이용 규칙·호스트 소개. 우측(또는 하단) **예약 폼**(날짜·인원·요금·예약하기) |
| 위시리스트 | `/wishlist` | (로그인 시) 찜한 숙소 모아보기 |

예약하기 클릭 시: 로그인 필요하면 로그인 유도 후 **예약 확인** 페이지로 이동.

---

## 3. 예약 요청 (결제 없음)

| 화면 | 경로 | 내용 |
|------|------|------|
| 예약 확인 | `/booking/confirm` | 일정·인원·요금·예약 진행 방식(3단계) 안내, 예약자 정보(성함·이메일·전화·특별요청) 입력 |
| 제출 | POST 예약 | "예약 요청하기" → **결제 없이** 예약 생성 (`status: pending`) |
| 완료 | **메시지창 직행** | 성공 시 **해당 예약의 메시지창**(`/messages/[conversationId]`)으로 이동. 도쿄민박 공식 메시지 2건(인사 + "호스트가 승인하시면 결제 방법을 안내해 드릴게요.") 표시. (대화방 없으면 `/booking/requested`로 이동) |

---

## 4. 호스트 승인 대기

- **내 예약** (`/my-bookings`)에서 상태 확인: "호스트 응답 대기", 진행 1/3 단계 표시.
- 호스트가 24시간 이내 **승인** 또는 **거절**.
- 거절 시: 게스트에게 이메일 등으로 안내 (예약 취소).

### 4.1 호스트 승인 기한과 게스트 안심 UX

**질문:** 예약 요청 후, 호스트가 최대 몇 시간 안에 승인을 완료해야 게스트가 가장 안심할 수 있을까?

| 대안 | 기한 | 게스트 관점 장점 | 게스트 관점 단점 | 호스트/운영 관점 |
|------|------|------------------|------------------|------------------|
| **A. 12시간** | 12시간 이내 | 답이 빨리 와서 불안이 짧음; 당일 안에 결론 가능 | 밤/새벽 요청 시 다음날 오전까지 기다릴 수 있음; 호스트 부담 증가 시 승인율·속도 저하 가능 | 호스트 부담 큼, 시간대/수면 고려 필요 |
| **B. 24시간 (현행)** | 24시간 이내 | 업계 관례에 가깝고, 호스트가 하루 안에 확인할 여유 있음; “언제까지 기다리면 돼”가 명확함 | 하루 내 답이 안 오면 불안해질 수 있음 | 균형이 좋음; 국내·에어비앤비 등에서 널리 사용 |
| **C. 48시간** | 48시간 이내 | 호스트 여유가 커서 승인 가능성은 높을 수 있음 | 2일 기다리는 동안 “거절될까” 불안·다른 숙소로 눈돌아갈 수 있음 | 게스트 이탈·경쟁사 비교 가능성 증가 |

**권장(게스트 최선 UX 전제):**

- **기한은 24시간 유지**를 추천합니다.
  - “최대 24시간 이내에 승인/거절”이라고 **처음부터** 예약 확인·메시지·이메일에서 **같은 문구**로 안내하면, 게스트는 “언제까지 기다리면 되는지”를 알 수 있어 심리적으로 가장 안정적입니다.
  - 12시간은 게스트에게는 좋지만 호스트 부담이 커져, 오히려 답이 늦어지거나 거절이 늘 수 있습니다.
  - 48시간은 대기 불안이 길어져 게스트 UX가 떨어질 수 있습니다.

**추가로 할 수 있는 것(선택):**

- **예약 요청 직후** 한 줄 안내:  
  “호스트가 **24시간 이내**에 승인/거절합니다. 보통 몇 시간 안에 답변이 올 수 있어요.”  
  → 기한(24h) + “보통은 더 빨라요”로 기대치를 잡아주면 안심에 도움이 됩니다.
- **내 예약·메시지창**에 “호스트 응답 기한: 요청일로부터 24시간”처럼 **남은 시간 또는 기한 일시**를 표시하면, “언제까지 기다리면 되는지”가 더 분명해져 불안이 줄어듭니다.
- (데이터가 쌓이면) “이 호스트는 평균 ○시간 내 답변해요” 같은 문구를 넣으면, 24시간은 “최대값”이고 보통은 더 빠르다는 인상을 줄 수 있습니다.

---

## 5. 호스트 승인 후 → 결제

| 경로 | 내용 |
|------|------|
| **메시지창** | 호스트 승인 시 같은 대화방에 도쿄민박 공식("도쿄민박 운영자") 메시지 1건("호스트승인이 완료되었어요. 결제 안내드릴게요."). 게스트는 **메시지창 상단** "호스트가 승인했습니다. 24시간 이내에 결제해 주세요." 배너의 **결제하기** 버튼으로 `/booking/[id]/pay` 진입 |
| 이메일 | "호스트 승인 완료" 메일 + **결제하기** 버튼(24시간 이내 결제 안내) |
| 예약 완료 페이지 | `/booking/complete?id=...` 재방문 시 "호스트가 예약을 승인했습니다" + **결제하기** CTA |
| 내 예약 | "호스트 승인 · 결제 대기", 2/3 단계, **결제하기** / 재결제하기 버튼 |
| 결제 페이지 | `/booking/[id]/pay` — 진행 스텝(3단계) + 숙소 요약 + 결제 금액 + 결제 버튼 |

결제 완료 시 `paymentStatus: paid` → **예약 확정**.

---

## 6. 예약 확정 후 (숙박 전·중)

| 기능 | 설명 |
|------|------|
| **내 예약** | 예약 확정된 일정·숙소·금액 확인. **메시지**, **취소**(정책에 따라), **리뷰**(체크아웃 이후) 버튼 |
| **메시지** | `/messages` — 예약별 대화방 목록. 대화방 선택 시 `/messages/[id]`에서 호스트와 채팅. 체크인·체크아웃 시간, 숙소 규칙 등은 호스트가 메시지로 안내 |
| **결제 완료 직후** | 예약 완료 페이지에서 결제까지 끝난 경우, 대화방이 있으면 **메시지 페이지**로 리다이렉트될 수 있음 |

체크인·체크아웃 **시간/방법**은 앱에서 고정 플로우 없음 → "예약 확정 후 호스트가 안내" 문구대로 **메시지**로 확인.

---

## 7. 체크아웃 이후

| 기능 | 설명 |
|------|------|
| **내 예약** | 해당 예약 카드에 **리뷰 작성** 버튼 노출 (체크아웃일 지난 예약, 아직 리뷰 안 쓴 경우) |
| **리뷰** | 숙소 상세 페이지(`/listing/[id]#review`)로 이동해 리뷰 작성. 작성 완료 후 "리뷰 작성완료" 표시 |
| **취소/환불** | 취소는 내 예약에서 **취소** 버튼. 환불 완료 시 "환불완료" 배지 등으로 표시 |

---

## 8. 화면·경로 정리

| 구간 | 대표 경로 |
|------|-----------|
| 문의(예약 전) | 카톡(전역 버튼), 푸터 문의처 |
| 검색 | `/`, `/search` |
| 숙소 상세 | `/listing/[id]` |
| 예약 확인 | `/booking/confirm` |
| 예약 완료(상태 허브) | `/booking/complete?id=...` |
| 내 예약 | `/my-bookings` |
| 결제 | `/booking/[id]/pay` |
| 메시지 | `/messages`, `/messages/[id]` |
| 리뷰 | `/listing/[id]#review` (내 예약에서 진입) |

---

## 9. 요약 한 줄

**문의(카톡/전화) → 검색·숙소 선택 → 예약 요청(결제 없음) → 메시지창으로 직행·공식 안내 확인 → 호스트 승인 대기 → 승인 후 메시지창/이메일에서 결제 → 예약 확정 → 메시지로 체크인/규칙 확인 → 숙박·체크아웃 → (선택) 리뷰 작성.**

---

## 10. 구현 요약 (메시지창 중심 플로우)

아래 플로우는 **예약 직후 메시지창 직행**, **호스트 승인 시 채팅 안내**, **메시지창 내 결제 CTA** 로 구현되어 있습니다.

| 구간 | 담당 | 파일/API |
|------|------|----------|
| 공식 발신자 | 도쿄민박 공식 User 1명 | 시드 `official@tokyominbak.com`, `src/lib/official-account.ts` |
| 예약 생성 직후 | 대화방 생성 + 공식 메시지 2건, 응답에 `conversationId` | `POST /api/bookings` (`src/app/api/bookings/route.ts`) |
| 예약 성공 후 이동 | 메시지창으로 리다이렉트 | `src/app/booking/confirm/BookingConfirmContent.tsx` |
| 호스트 승인 시 | 대화방 생성 + 결제 안내 메시지 1건 | `PATCH /api/host/bookings/[id]` (`src/app/api/host/bookings/[id]/route.ts`) |
| 메시지창 결제 CTA | 게스트·승인됨·미결제 시 상단 배너 + 결제하기 버튼 | `src/app/messages/[id]/page.tsx` |

**검증 체크리스트 (배포 전 또는 기능 수정 후 권장)**

1. [ ] 로그인한 게스트로 숙소에서 **예약 요청하기** 클릭 → 성공 시 **메시지창**(`/messages/...`)으로 이동하는지 확인
2. [ ] 해당 메시지창에 **도쿄민박** 발신 메시지 2건(인사 + "호스트가 승인하시면 결제 방법을 안내해 드릴게요.")이 보이는지 확인
3. [ ] 호스트로 해당 예약 **승인** → 같은 대화방에 "도쿄민박 운영자" 발신 "호스트승인이 완료되었어요. 결제 안내드릴게요." 메시지가 추가되는지 확인
4. [ ] 게스트로 메시지창 접속 시 **상단에 결제 CTA**("호스트가 승인했습니다. 24시간 이내에 결제해 주세요." + 결제하기 버튼)가 보이는지 확인
5. [ ] 결제하기 클릭 → `/booking/[id]/pay` 로 이동해 결제 플로우가 정상 동작하는지 확인

**공식 계정이 없을 때**: 시드를 실행하지 않은 DB에서는 공식 메시지가 생성되지 않습니다. 서버 로그에 `[Booking] Official account not found` 경고가 뜨면 `npm run db:seed` 로 공식 계정(`official@tokyominbak.com`)을 생성하세요.
